<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Drug Interaction Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 420px;
            margin: 60px auto;
            background: #fff;
            padding: 32px 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        h2 {
            text-align: center;
            margin-bottom: 24px;
        }

        textarea {
            width: 100%;
            height: 80px;
            padding: 8px;
            font-size: 1em;
            border-radius: 4px;
            border: 1px solid #ccc;
            resize: vertical;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 16px;
            background: #0078d4;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
        }

        .result {
            margin-top: 24px;
            padding: 16px;
            border-radius: 4px;
            background: #f0f8ff;
            min-height: 40px;
        }

        .severity-high {
            color: #d8000c;
        }

        .severity-moderate {
            color: #9f6000;
        }

        .severity-low {
            color: #00529b;
        }

        .disclaimer {
            margin-top: 32px;
            padding: 12px 16px;
            background: #fffbe6;
            border-left: 4px solid #ffc107;
            border-radius: 6px;
            color: #856404;
            font-size: 0.95em;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
            text-align: left;
        }
    </style>
</head>

<body>
    <div class="container" style="display: flex; flex-direction: column; align-items: center;">
        <h2>Drug Interaction Checker</h2>
        <label for="drugs">Enter drug names (comma separated):</label>
        <textarea id="drugs" placeholder="e.g. Aspirin, Ibuprofen, Paracetamol"></textarea>
        <button onclick="checkInteractions()">Check Interactions</button>
        <div class="result" id="result"></div>
        <div class="disclaimer">
            <strong>Disclaimer:</strong><br>
            This tool is for informational and educational purposes only.
            It does not constitute medical advice, diagnosis, or treatment. Always 
            consult a qualified healthcare professional or pharmacist before making any 
            decisions about medications.
        </div>
    </div>
    <script>
        // Example interaction data (for demo purposes)

        const severityLabels = {
            high: '<span class="severity-high">High Severity</span>',
            moderate: '<span class="severity-moderate">Moderate Severity</span>',
            low: '<span class="severity-low">Low Severity</span>'
        };

        async function checkInteractions() {
            const input = document.getElementById('drugs').value;
            const drugs = input.split(',').map(d => d.trim().toLowerCase()).filter(Boolean);
            const resultDiv = document.getElementById('result');

            if (drugs.length < 2) {
                resultDiv.innerHTML = "Please enter at least two drugs.";
                return;
            }

            try {
                // Prepare the API request
                const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-goog-api-key": "AIzaSyB5P2ggDEPKUE72hwgwFq0M2Y5ICzRLW1M"
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                parts: [
                                    {
                                        text: `Check for drug interactions among: ${drugs.join(", ")}.
                                        Respond only with a valid JSON object, nothing else.
                                        Format:
                                        {
                                        "severity": "high|moderate|low|none",
                                        "description": ["item1", "item2", "..."],
                                        "final_recommendation": "summary of what to do"
                                        }

Drugs: ${drugs.join(", ")}`
                                    }
                                ]
                            }
                        ]
                    })
                });

                // Handle the API response
                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                const data = await response.json();
                const generatedText = data?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (generatedText) {
                    let interactionData;
                    try {
                        // Try to find the first valid JSON object in the response
                        const jsonMatch = generatedText.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            interactionData = JSON.parse(jsonMatch[0].replace(/'/g, '"'));
                        } else {
                            throw new Error("No JSON object found in Gemini response.");
                        }
                    } catch (jsonError) {
                        console.error("JSON parsing error:", jsonError);
                        console.log("Raw Gemini response:", generatedText);
                        resultDiv.innerHTML = "Received unexpected format from Gemini. Please try again.";
                        return;
                    }

                    // Build the HTML output
                    let output = `<h3>Interaction Details</h3>`;
                    output += `<p><strong>Severity:</strong> <span class="severity-${interactionData.severity}">${interactionData.severity.charAt(0).toUpperCase() + interactionData.severity.slice(1)}</span></p>`;
                    output += `<h4>Description:</h4><ul>`;
                    if (Array.isArray(interactionData.description)) {
                        interactionData.description.forEach(item => {
                            output += `<li>${item}</li>`;
                        });
                    } else {
                        output += `<li>${interactionData.description}</li>`;
                    }
                    output += `</ul>`;
                    output += `<h4>Final Recommendation:</h4><p>${interactionData.final_recommendation || ''}</p>`;

                    resultDiv.innerHTML = output;
                } else {
                    resultDiv.innerHTML = "No interaction data found.";
                }
            } catch (error) {
                console.error("Error checking interactions:", error);
                resultDiv.innerHTML = "An error occurred while checking interactions. Please try again.";
            }
        }
    </script>
</body>

</html>
